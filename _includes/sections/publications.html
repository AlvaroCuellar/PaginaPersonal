<section id="publications" class="publications scrollto">
  <div class="row clearfix">
    {% assign lang = page.lang | default: 'es' %}
    <div class="col-1">
      <div class="section-heading">
        {% if site.data.home.publications.subtitle[lang] %}
          <h3>{{ site.data.home.publications.subtitle[lang] }}</h3>
        {% endif %}
        <h2 class="section-title">{{ site.data.home.publications.section_title[lang] }}</h2>
      </div>

      <!-- Featured Publications (2 columns) -->
      <div class="featured-publications">
        {% for pub_id in site.data.home.publications.featured_ids limit:2 %}
          {% assign pub = site.data.home.publications.publications | where: "id", pub_id | first %}
          {% if pub %}
            <div class="featured-publication-card">
              {% if pub.thumbnail %}
                <div class="publication-thumbnail">
                  <img src="{{ pub.thumbnail }}" alt="{{ pub.title }}" class="pub-thumb">
                </div>
              {% endif %}
              <div class="publication-content">
                <h5 class="category-label">{{ site.data.i18n[lang].publication_types[pub.type] | default: pub.type | capitalize }}</h5>
                <div class="publication-title">{{ pub.title }}</div>
                <div class="publication-authors">{{ pub.authors | join: ", " }}</div>
                <div class="publication-metadata">
                  <div class="publication-source">
                    {% assign source_text = "" %}
                    {% if pub.publication and pub.publication != "" %}
                      {% assign source_text = "<em>" | append: pub.publication | append: "</em>" %}
                    {% endif %}
                    {% if pub.year and pub.year != "" %}
                      {% if source_text != "" %}{% assign source_text = source_text | append: ", " %}{% endif %}
                      {% assign source_text = source_text | append: pub.year %}
                    {% endif %}
                    {{ source_text }}
                  </div>
                  {% if pub.cited_by and pub.cited_by.size > 0 %}
                    <div class="citation-count">{{ pub.cited_by.size }} {{ site.data.i18n[lang].citations | default: "citas" }}</div>
                  {% endif %}
                  <div class="publication-buttons">
                    {% if pub.url %}<a href="{{ pub.url }}" target="_blank" class="button no-icon">{{ site.data.i18n[lang].access_text }}</a>{% endif %}
                    {% if pub.doi %}<a href="https://doi.org/{{ pub.doi }}" target="_blank" class="button no-icon">DOI</a>{% endif %}
                    {% if pub.assets.pdf %}<a href="{{ pub.assets.pdf }}" target="_blank" class="button no-icon">{{ site.data.i18n[lang].publication_buttons.pdf }}</a>{% endif %}
                    {% if pub.assets.code %}<a href="{{ pub.assets.code }}" target="_blank" class="button no-icon">{{ site.data.i18n[lang].publication_buttons.code }}</a>{% endif %}
                    {% if pub.assets.slides %}<a href="{{ pub.assets.slides }}" target="_blank" class="button no-icon">{{ site.data.i18n[lang].publication_buttons.slides }}</a>{% endif %}
                    {% if pub.assets.data %}<a href="{{ pub.assets.data }}" target="_blank" class="button no-icon">{{ site.data.i18n[lang].publication_buttons.data }}</a>{% endif %}
                  </div>
                </div>
              </div>
            </div>
          {% endif %}
        {% endfor %}
      </div>

      <!-- All Publications Grid -->
      <div class="publication-grid">
        {% for pub in site.data.home.publications.publications %}
          <div class="publication-card">
            <h5 class="category-label">{{ site.data.i18n[lang].publication_types[pub.type] | default: pub.type | capitalize }}</h5>
            <div class="publication-title">{{ pub.title }}</div>
            <div class="publication-authors">{{ pub.authors | join: ", " }}</div>
            <div class="publication-metadata">
              <div class="publication-source">
                {% assign source_text = "" %}
                {% if pub.publication and pub.publication != "" %}
                  {% assign source_text = "<em>" | append: pub.publication | append: "</em>" %}
                {% endif %}
                {% if pub.year and pub.year != "" %}
                  {% if source_text != "" %}{% assign source_text = source_text | append: ", " %}{% endif %}
                  {% assign source_text = source_text | append: pub.year %}
                {% endif %}
                {{ source_text }}
              </div>
              {% if pub.cited_by and pub.cited_by.size > 0 %}
                <div class="citation-count">{{ pub.cited_by.size }} {{ site.data.i18n[lang].citations | default: "citas" }}</div>
              {% endif %}
              <div class="publication-buttons">
                {% if pub.url %}<a href="{{ pub.url }}" target="_blank" class="button no-icon">{{ site.data.i18n[lang].access_text }}</a>{% endif %}
                {% if pub.doi %}<a href="https://doi.org/{{ pub.doi }}" target="_blank" class="button no-icon">DOI</a>{% endif %}
                {% if pub.assets.pdf %}<a href="{{ pub.assets.pdf }}" target="_blank" class="button no-icon">{{ site.data.i18n[lang].publication_buttons.pdf }}</a>{% endif %}
                {% if pub.assets.code %}<a href="{{ pub.assets.code }}" target="_blank" class="button no-icon">{{ site.data.i18n[lang].publication_buttons.code }}</a>{% endif %}
                {% if pub.assets.slides %}<a href="{{ pub.assets.slides }}" target="_blank" class="button no-icon">{{ site.data.i18n[lang].publication_buttons.slides }}</a>{% endif %}
                {% if pub.assets.data %}<a href="{{ pub.assets.data }}" target="_blank" class="button no-icon">{{ site.data.i18n[lang].publication_buttons.data }}</a>{% endif %}
              </div>
            </div>
          </div>
        {% endfor %}
      </div>

      <div class="more-cv">
        <a href="{% if lang == 'en' %}/en{% else %}/es{% endif %}/cv/#publications" class="link-button">
          {{ site.data.i18n[lang].more_cv.publications }}
        </a>
      </div>
    </div>
  </div>
</section>
